---
title: 秒杀与拼团系统架构设计
date: 2019-05-23 19:45:09
tags: [高并发, 系统设计]
thumbnail: /gallery/333.jpg
toc: true
categories: Back-End
---


从业务上来看, 这两个系统有什么共同的特性呢?

1. 瞬时性
    用户了解活动时间后会在时间点周围记性大量的网络请求
2. 用户数量限制
    并不是参与有将, 永远都只有固定的, 少量的用户可以获得最终的商品
3. 产品数量限制
    获得的商品是有数量限制的

    <!-- more -->

那么可能在活动开始的一瞬间,原本的QPS或者TPS 相对于普通时间段来说会以一个指数型增长.
那么如何提高系统的抗压能力以及保证业务的正确性成为系统设计的根本.

***
我们首先来分析, 我们要解决什么问题.

假设现有一个秒杀活动吸引了20000个用户来参加, 那么最高并发理论值就是20000.
对于原有系统来说, 这个瞬时并发会击垮原有的服务, 导致所有业务瘫痪. 对系统和用户的留存都是致命的.

> 1. 维护原有业务

用户会在活动开始前对网站或者特定页面会有突然性的高刷新的频率. 而如果按照一般的设计, 会对应用服务, 数据库访问
以及相对应页面资源服务造成极大的压力

> 2. 应用数据库负载

如果一个用户页面大小是100K那么需要的网络和服务器贷款就是 2G= 100K * 20000. 带宽是很贵的. 没有任何一家公司会购买
高于平均使用量的带宽

> 3. 带宽压力

很多情况下, 一个稍微有点计算机基础的人都可以通过html挖出很多网站的元素. 如果秒杀地址是暴露的, 那么很容易给这部分用户写成脚本来恶意竞争
或者对服务器进行攻击.

> 4. 秒杀URL和下单业务流程


针对以上问题. 我们逐步来分析:

### 秒杀系统独立部署

由于秒杀服务于常规业务的流量有很大的不同, 为了维护原有的系统架构并且保护一半业务系统, 我们应当将秒杀业务独立的分离出. 并对其进行伸缩性部署和负载均衡.
如果需要, 可以对其使用独立域名. 这样即使秒杀系统奔溃了. 也可以让用户找得到投诉的地方

### 秒杀页面优化

如果是网页,并且原有的页面是通过动态生成的. 那么这部分的页面, 我们需要对其进行静态化, 并且将页面提前写入缓存当中. 并且对其中的一些数据进行写死或者直接写
在缓存中, 减少并发时对于数据库的负载. 并对静态资源进行CDN部署, 保证用户访问速率

### 活动带宽

活动之前不要忘记提前租借带宽哦. 不然因为带宽不够影响业务就尴尬了

### 动态URL

为了避免用户直接下单. URL应该是动态的. 每次产生生成订单的行为之后, 应该由服务器生成一个带随机数的URL来给用户指向订单支付页面.

整个系统大致如下

![设计图](2.png)

其中还有很多针对不同场景或者平台的一些优化. 待续